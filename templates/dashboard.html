<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - Smart Expense Tracker</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
<div class="container">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <button onclick="showAddExpense()">âž• Add Expense</button>
        <button onclick="fetchExpenses()">ðŸ“‹ All Expenses</button>
        <button onclick="fetchTotal()">ðŸ’° Total</button>
        <button onclick="showAITips()">ðŸ¤– AI Tips</button>
        <button onclick="showChat()">ðŸ’¬ AI Chat</button>
        <button onclick="window.location.href='/logout'">ðŸšª Logout</button>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <h2>Welcome, {{ username }}</h2>

        <!-- ADD EXPENSE / OTHER OUTPUT -->
        <div id="output"></div>

        <!-- AI TIPS -->
        <div id="ai-tips" style="display:none;">
            <h3>ðŸ¤– Smart AI Tips</h3>
            <button onclick="getAITip()">Get AI Tip</button>
            <p id="ai-tip"></p>
        </div>

        <!-- AI CHAT -->
        <div id="chat-box" style="display:none;">
            <h3>ðŸ’¬ AI Expense Assistant</h3>

            <div id="chat-messages" style="border:1px solid #ccc; padding:10px; height:150px; overflow:auto;"></div>

            <input type="text" id="chat-input" placeholder="Ask about expenses..." />
            <button onclick="sendChat()">Send</button>
        </div>
    </div>

</div>

<script>
/* -------- UI TOGGLE FUNCTIONS -------- */

function hideAll() {
    document.getElementById("ai-tips").style.display = "none";
    document.getElementById("chat-box").style.display = "none";
}

function showAITips() {
    hideAll();
    document.getElementById("ai-tips").style.display = "block";
}

function showChat() {
    hideAll();
    document.getElementById("chat-box").style.display = "block";
}

/* -------- AI TIPS -------- */

function getAITip() {
    fetch("/ai_tips")
    .then(res => res.json())
    .then(data => {
        document.getElementById("ai-tip").innerText = data.tip;
    })
    .catch(err => {
        document.getElementById("ai-tip").innerText = "Error getting AI tip";
    });
}

/* -------- AI CHAT -------- */

function sendChat() {
    const msg = document.getElementById("chat-input").value;
    if (!msg) return;

    fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
    })
    .then(res => res.json())
    .then(data => {
        const box = document.getElementById("chat-messages");
        box.innerHTML += `<p><b>You:</b> ${msg}</p>`;
        box.innerHTML += `<p><b>AI:</b> ${data.response}</p>`;
        document.getElementById("chat-input").value = "";
    });
}
</script>

</body>
</html>
