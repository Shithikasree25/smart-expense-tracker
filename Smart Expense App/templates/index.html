<!DOCTYPE html>
<html>
<head>
<title>Smart Expense Tracker</title>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:linear-gradient(135deg,#667eea,#764ba2);
    height:100vh;
}
.login-box{
    width:320px;
    background:white;
    margin:120px auto;
    padding:25px;
    border-radius:10px;
    box-shadow:0 15px 40px rgba(0,0,0,.3);
    text-align:center;
}
.login-box h2{margin-bottom:20px}
input{
    width:100%;
    padding:10px;
    margin:8px 0;
}
button{
    width:100%;
    padding:10px;
    margin-top:10px;
    background:#667eea;
    color:white;
    border:none;
    cursor:pointer;
}
button:hover{background:#5a67d8}

/* DASHBOARD */
.dashboard{
    display:none;
    height:100vh;
}
.sidebar{
    width:220px;
    background:#1a202c;
    color:white;
    height:100%;
    float:left;
    padding:20px;
}
.sidebar button{
    background:#2d3748;
    margin:10px 0;
}
.main{
    margin-left:220px;
    padding:30px;
}
.card{
    display:none;
    background:white;
    padding:20px;
    border-radius:10px;
    box-shadow:0 10px 30px rgba(0,0,0,.2);
}
pre{
    background:#f5f5f5;
    padding:10px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login-box" id="loginBox">
    <h2>Smart Expense Tracker</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dashboard">

    <div class="sidebar">
        <h3>Dashboard</h3>
        <button onclick="showAdd()">Add Expense</button>
        <button onclick="showAll()">All Expenses</button>
        <button onclick="showTotal()">Total</button>
        <button onclick="showTips()">AI Tips</button>
    </div>

    <div class="main">
        <div class="card" id="addCard">
            <h3>Add Expense</h3>
            <input id="amount" placeholder="Amount">
            <input id="category" placeholder="Category">
            <button onclick="addExpense()">Submit</button>
        </div>

        <div class="card" id="allCard">
            <h3>All Expenses</h3>
            <pre id="allData"></pre>
        </div>

        <div class="card" id="outputCard"></div>
    </div>
</div>

<script>
let USER_ID = null;

/* ---------- AUTH ---------- */
function register(){
    fetch("/register",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            username:username.value,
            password:password.value
        })
    })
    .then(r=>r.json())
    .then(d=>alert(d.msg));
}

function login(){
    fetch("/login",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            username:username.value,
            password:password.value
        })
    })
    .then(r=>r.json())
    .then(d=>{
        if(d.success){
            USER_ID = d.user_id;   // ðŸ”‘ FIX
            loginBox.style.display="none";
            dashboard.style.display="block";
            showAdd();
        }else{
            alert(d.msg);
        }
    });
}

/* ---------- UI ---------- */
function hideAll(){
    document.querySelectorAll(".card").forEach(c=>c.style.display="none");
}
function showAdd(){
    hideAll();
    addCard.style.display="block";
}
function showAll(){
    hideAll();
    allCard.style.display="block";
    fetch(`/getExpenses/${USER_ID}`)
    .then(r=>r.json())
    .then(d=>{
        allData.textContent = JSON.stringify(d,null,2);
    });
}
function showTotal(){
    hideAll();
    outputCard.style.display="block";
    fetch(`/getTotal/${USER_ID}`)
    .then(r=>r.json())
    .then(d=>{
        outputCard.innerHTML = `<h3>Total Spending</h3><p>â‚¹ ${d.total}</p>`;
    });
}
function showTips(){
    hideAll();
    outputCard.style.display="block";
    fetch(`/getTips/${USER_ID}`)
    .then(r=>r.json())
    .then(d=>{
        outputCard.innerHTML = `<h3>AI Tip</h3><p>${d.tip}</p>`;
    });
}

/* ---------- EXPENSE ---------- */
function addExpense(){
    fetch("/addExpense",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            user_id:USER_ID,
            amount:amount.value,
            category:category.value
        })
    })
    .then(()=>{
        alert("Expense Added");
        amount.value="";
        category.value="";
    });
}
</script>

</body>
</html>
